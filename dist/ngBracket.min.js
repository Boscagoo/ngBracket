/*! ngBracket 20-09-2014 */
var myApp=angular.module("ngBracket",[]);myApp.findParentByAttribute=function(a,b,c){if(null===a||null===b||null===c)return null;for(var d=null,e=angular.element(a);null!==e.parent()&&e.parent().length>0;)if(e=e.parent(),e.attr(b)===c){d=e;break}return d},myApp.filter("iif",function(){return function(a,b,c){return a?b:c}}),myApp.filter("getById",function(){return function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];return null}}),myApp.factory("highlight",function(){var a={teamId:null};return{mapHighlight:function(){return a},setHighlight:function(b){a.teamId=b&&b.length>0?b:null}}}),myApp.findFirstRound=function(a){for(var b=0;b<a.length;b++)if("L"!==a[b][0].meta.matchId.slice(-1))return b;return null},myApp.factory("data",function(){var a={},b={},c=null;return{getTeams:function(){return a},getMatches:function(){return b.matches},getTournamentType:function(){return b.type},getProperties:function(){return b.properties},shuffleTeams:function(){if(a&&b&&"Not started"==b.properties.status){for(var d,e,f=a.length,g=a.slice();0!==f;)e=Math.floor(Math.random()*f),f-=1,d=g[f],g[f]=g[e],g[e]=d;var h,i=0;"DE"===this.getTournamentType()&&null===c&&(c=angular.module("ngBracket").findFirstRound(b.matches));var j="DE"===this.getTournamentType()?c:0;for(h=0;h<b.matches[j].length&&"L"!==b.matches[j][h].meta.matchId.slice(-1);h++)b.matches[j][h].team1.id=g[i].id,b.matches[j][h].team2.id=g[i+1].id,i+=2;if(b.properties.unbalanced)for(j+=1,h=0;h<b.matches[j].length&&!(i>=g.length||"L"===b.matches[j][h].meta.matchId.slice(-1));h++)1===b.matches[j][h].meta.matchType?(b.matches[j][h].team1.id=g[i].id,i+=1):2===b.matches[j][h].meta.matchType&&(b.matches[j][h].team1.id=g[i].id,b.matches[j][h].team2.id=g[i+1].id,i+=2)}},updateTournament:function(a,c,d,e,f){function g(a,b,c,d){null!==a&&(-1!==c.indexOf(a.team1.id)?a.team1.id=b:-1!==c.indexOf(a.team2.id)?a.team2.id=b:!(d||u>n)||a.team1.id&&0!==a.team1.id.length?a.team2.id=b:a.team1.id=b)}function h(a,c){for(var d=0;d<b.matches[c].length;d++)if(b.matches[c][d].meta.matchType==a)return b.matches[c][d];return null}"Not started"===b.properties.status&&(b.properties.status="In progress");var i,j,k,l=a.meta.matchId.split("-"),m=parseInt(l[1]),n=parseInt(l[2]),o=l.length>3&&"L"===l[3],p=m===b.matches.length-1;if("DE"===b.type&&"finals"===a.meta.matchType){var q=b.matches.length-2;k=b.matches[q].length-1,j=b.matches[q][k].team1.score>b.matches[q][k].team2.score?b.matches[q][k].team1.id:b.matches[q][k].team2.id,b.properties.finals2=d!=j;var r=h("finals2",b.matches.length-1);return void(d!=j?null!==r&&(r.team1.id=a.team1.id,r.team2.id=a.team2.id):null!==r&&(r.team1.id="",r.team2.id="",r.team1.score="",r.team2.score=""))}if(("SE"!==b.type||m!==b.matches.length)&&("DE"!==b.type||"bronze"!==a.meta.matchType&&"finals2"!==a.meta.matchType)){var s=[a.team1.id,a.team2.id];if(null!==e&&e.length>0&&s.push(e),"SE"===b.type&&p&&b.matches[b.matches.length-1].length>1||"DE"===b.type&&o&&(p||m===b.matches.length-2)){k=b.matches[b.matches.length-1].length;var t=h("bronze",b.matches.length-1);g(t,d,s,1===n)}var u=0,v=b.matches[m],w=o&&p;for(i=0;i<v.length;i++)if(2!=v[i].meta.matchType){if(o&&"L"!==v[i].meta.matchId.slice(-1)&&!p)continue;if(u+=1==v[i].meta.matchType?1:2,u>=n){g(v[i],c,s,w);break}}if(f){var x=parseInt(a.meta.loserMatchId.split("-")[1])-1,y=b.matches[x];for(i=y.length-1;i>=0;i--){if(y[i].meta.team1Parent===a.meta.matchId){y[i].team1.id=d;break}if(y[i].meta.team2Parent===a.meta.matchId){y[i].team2.id=d;break}}}}},loadTournament:function(d,e){a=e,b=d,c="DE"===d.type?angular.module("ngBracket").findFirstRound(d.matches):null}}}),myApp.factory("connectorService",["data",function(a){return{findConnectingMatchId:function(b){var c,d,e=b.meta.matchId.split("-"),f=parseInt(e[1]),g=parseInt(e[2]),h="L"===b.meta.matchId.slice(-1)?"-L":"",i=0,j=a.getMatches(),k=0;if("finals2"===b.meta.matchType)d="match-"+f+"-1";else{if(h.length>0)for(c=0;c<j[f-1].length;c++)if("L"===j[f-1][c].meta.matchId.slice(-1)){k=c;break}for(c=0;g>c;c++)2!=j[f-1][c+k].meta.matchType&&(i+=1==j[f-1][c+k].meta.matchType||c+1==g?1:2);d="match-"+(f-1)+"-"+i+h}return d},findConnectingMatch:function(a){return angular.element(document.getElementById(this.findConnectingMatchId(a)))},findChildMatch:function(a){for(var b=angular.element(a).children(),c=0;c<b.length;c++)if(angular.element(b[c]).hasClass("match"))return angular.element(b[c])}}}]),myApp.factory("positioningService",["data",function(a){var b=function(b){function c(a){return"L"!==a.meta.matchId.slice(-1)}function e(a){return"L"===a.meta.matchId.slice(-1)}var f=document.getElementsByClassName("roundHeader")[0],g=document.getElementsByClassName("round")[0];if(matchEl=document.createElement("div"),matchEl.style.visibility="hidden",matchEl.className="match",g.appendChild(matchEl),document.all?(b.matchHeight=matchEl.currentStyle.height,b.matchWidth=matchEl.currentStyle.width,b.matchMarginH=parseInt(matchEl.currentStyle.marginRight),b.matchMarginV=parseInt(matchEl.currentStyle.marginTop)+parseInt(matchEl.currentStyle.marginBottom),b.borderThickness=parseInt(matchEl.currentStyle.borderWidth),b.roundMarginTop=f.currentStyle.height+parseInt(f.currentStyle.marginTop)+parseInt(f.currentStyle.marginBottom)):(b.matchHeight=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("height").replace("px","")),b.matchWidth=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("width").replace("px","")),b.matchMarginH=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-right").replace("px","")),b.matchMarginV=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-bottom")),b.borderThickness=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("border-right-width")),b.roundMarginTop=parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("height").replace("px",""))+parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("margin-bottom"))),"DE"===a.getTournamentType()){var h=a.getMatches(),i=angular.module("ngBracket").findFirstRound(h);i&&(b.startingRound=i+1,b.roundHeight=Math.max(h[i].filter(c).length,h[i+1].filter(c).length),b.roundHeight+=Math.max(h[0].filter(e).length,h[1].filter(e).length)),b.lbOffset=a.getProperties().lbOffset*(b.matchHeight+b.matchMarginV)+b.roundMarginTop}g.removeChild(matchEl),d=!0},c={matchHeight:null,matchWidth:null,matchMarginH:null,matchMarginV:null,borderThickness:null,roundMarginTop:null,startingRound:null,roundHeight:null,lbOffset:null},d=!1;return{getBracketProperties:function(){return d||b(c),JSON.parse(JSON.stringify(c))},resetProperties:function(){d=!1,c.startingRound=null,c.roundHeight=null}}}]),myApp.factory("dialogServiceBase",function(){return{show:function(a,b,c,d,e){if(null!==a){if(e&&null!==b&&b.getBoundingClientRect()){var f=b.getBoundingClientRect(),g=f.right+(void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft),h=f.top+(void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop),i=f.height,j=a[0].getBoundingClientRect().height;h+=j>i?j/-2+i/2:i/2-j/2,a.css("left",g+c+"px"),a.css("top",h+d+"px")}a.css("visibility","visible")}},hide:function(a){null!==a&&a.css("visibility","hidden")}}}),myApp.createCloseOnEscEventHandler=function(a,b){return function(a,b){return function(c){27===c.keyCode&&b.call(a)}}(a,b)},myApp.factory("matchDetailService",["dialogServiceBase","$document",function(a,b){var c=null,d={},e="",f=!1,g=!1,h=null;return{setEnabled:function(a){g=a},mapMatchDetails:function(){return d},show:function(i,j,k){if(h=angular.module("ngBracket").createCloseOnEscEventHandler(this,this.hide),g){if(null!==c&&"visible"==c.css("visibility")&&j.matchId==e)return void this.hide();if(e=j.matchId,d.team1Details=j.team1Details,d.team2Details=j.team2Details,d.results=j.results,f||(c=angular.element(document.getElementById("detailOverlay")),f=!0),null!==c&&null!==i){var l=angular.module("ngBracket").findParentByAttribute(i,"class","match")[0];b.unbind("keyup",h).bind("keyup",h),a.show(c,l,0,0,k)}}},hide:function(){b.unbind("keyup",h),h=null,a.hide(c)}}}]),myApp.factory("teamSelectService",["dialogServiceBase","data","$document",function(a,b,c){var d=null,e=null,f=null,g=null;return{show:function(h,i,j){f=angular.module("ngBracket").createCloseOnEscEventHandler(this,this.hide),g=function(a,b){return function(c){2!==c.button&&null===angular.module("ngBracket").findParentByAttribute(c.target,"id","selectTeamOverlay")&&b.call(a)}}(this,this.hide),"Not started"===b.getProperties().status&&(null===d&&(d=angular.element(document.getElementById("selectTeamOverlay"))),null!==d&&(c.unbind("keyup",f).bind("keyup",f),c.unbind("click",g).bind("click",g),e=i,a.show(d,h,0,0,j)))},hide:function(){e=null,null!==d&&(c.unbind("keyup",f),c.unbind("click",g),f=null,g=null,a.hide(d))},select:function(a){null!==e&&(e.id=a.id)}}}]);var myApp=angular.module("ngBracket");myApp.directive("doFocus",function(){return{restrict:"A",link:function(a,b){b&&(b[0].focus(),b[0].select())}}}),myApp.directive("score",["data",function(a){return{restrict:"E",scope:{team:"=",match:"=",results:"="},templateUrl:"partials/score.html",link:function(b){b.editScore=function(){b.match.team1.id&&b.match.team2.id&&(b.status="editable")},b.calculateResults=function(c){if("undefined"==typeof b.match.team1.score||""===b.match.team1.score||"undefined"==typeof b.match.team2.score||""===b.match.team2.score||b.match.team1.score===b.match.team2.score)return b.results.winner="",void(b.results.loser="");var d;b.match.team1.score>b.match.team2.score?(d=b.match.team1.id,b.results.loser=b.match.team2.id):(d=b.match.team2.id,b.results.loser=b.match.team1.id),b.results.winner=d;var e="DE"===a.getTournamentType()&&"L"!==b.match.meta.matchId.slice(-1);a.updateTournament(b.match,d,b.results.loser,c,e)},b.endEditScore=function(){b.status="uneditable",b.calculateResults(null)},b.$watch("match.team1.id",function(a,c){a&&b.calculateResults(c)},!0),b.$watch("match.team2.id",function(a,c){a&&b.calculateResults(c)},!0)},replace:!0}}]),myApp.directive("teamSelectMenu",["teamSelectService","data","$document",function(a,b){return{restrict:"A",scope:!1,link:function(c,d){"Not started"===b.getProperties().status&&d.bind("contextmenu",function(e){"Not started"===b.getProperties().status&&(e.preventDefault(),e.stopPropagation(),a.show(d[0],c.team,!0))})}}}]),myApp.directive("team",["data","highlight","teamSelectService",function(a,b,c){return{restrict:"E",templateUrl:"partials/team.html",replace:!1,scope:{team:"=",teamdetails:"=",description:"="},link:function(d){d.highlight=d.$parent.highlight,d.results=d.$parent.results,d.match=d.$parent.match,d.highlightTrack=function(a){b.setHighlight(a)},d.editTeam=function(b,c){"Not started"===a.getProperties().status&&(d.status=c)},d.endEditTeam=function(){d.status="uneditable"},d.selectTeam=function(b){"Not started"===a.getProperties().status&&c.show(b.target,team,!1)}}}}]),myApp.directive("match",["connectorService","positioningService","data","$filter","matchDetailService","highlight",function(a,b,c,d,e,f){return{restrict:"E",scope:!1,templateUrl:"partials/match.html",replace:!0,link:{pre:function(g,h){g.getTeamDetails=function(a){return d("getById")(c.getTeams(),a)},g.showDetails=function(a){null!==g.team1Details&&null!==g.team2Details&&a.target&&!angular.element(a.target).hasClass("score")&&e.show(a.target,{matchId:g.match.meta.matchId,team1Details:g.team1Details,team2Details:g.team2Details,results:g.match},!0)},g.highlight=f.mapHighlight(),g.team1Details=g.getTeamDetails(g.match.team1.id),g.team2Details=g.getTeamDetails(g.match.team2.id),g.$watch("match.team1",function(a){a&&(g.team1Details=g.getTeamDetails(g.match.team1.id))},!0),g.$watch("match.team2",function(a){a&&(g.team2Details=g.getTeamDetails(g.match.team2.id))},!0);var i=parseInt(g.match.meta.matchId.split("-")[1]),j=parseInt(g.match.meta.matchId.split("-")[2]),k=b.getBracketProperties();g.match.meta.team1Parent&&(g.team1Description="Loser of Round "+(parseInt(g.match.meta.team1Parent.split("-")[1])-k.startingRound+1)+" match "+g.match.meta.team1Parent.split("-")[2]),g.match.meta.team2Parent&&(g.team2Description="Loser of Round "+(parseInt(g.match.meta.team2Parent.split("-")[1])-k.startingRound+1)+" match "+g.match.meta.team2Parent.split("-")[2]),"finals2"===g.match.meta.matchType&&0===g.match.team1.id.length&&0===g.match.team2.id.length&&(g.team1Description="Finals round 2 if necessary",g.prop=c.getProperties()),h.prop("id","match-"+i+"-"+j),"finals"==g.match.meta.matchType&&(g.finals=!0),h.css("left",k.matchMarginH/2+"px");var l="finals2"===g.match.meta.matchType&&"DE"===c.getTournamentType();l&&h.css("left",k.matchMarginH/2+k.matchMarginH+k.matchWidth+"px");var m=0,n="finals"===g.match.meta.matchType&&"DE"===c.getTournamentType(),o="L"===g.match.meta.matchId.slice(-1)||n?"-L":"";if(1===i||i===k.startingRound&&0===o.length){var p=g.match.meta.UIShiftDown?g.match.meta.UIShiftDown:0;m=(k.matchHeight+k.matchMarginV)*(j-1+p)+k.roundMarginTop}else if(2===g.match.meta.matchType)m=(k.matchHeight+k.matchMarginV)*(j-1)+k.roundMarginTop,o.length>0&&k.lbOffset>0&&m<k.lbOffset&&(m+=k.lbOffset-k.roundMarginTop);else if("bronze"===g.match.meta.matchType){g.bronzeMatch=!0;var q=angular.element(document.getElementById("match-"+i+"-1"));m=q.prop("offsetTop")+k.matchHeight+40}else if(l){var r=angular.element(document.getElementById("match-"+i+"-1"));m=r.prop("offsetTop")}else{var s=a.findConnectingMatch(g.match);if(m=angular.element(s[0].firstElementChild).prop("offsetTop"),1!=g.match.meta.matchType){var t=parseInt(s.scope().match.meta.matchId.split("-")[2]),u="match-"+(i-1)+"-"+(n?"1-L":t+1+o),v=angular.element(document.getElementById(u)),w=angular.element(v[0].firstElementChild).prop("offsetTop")+k.matchHeight;n?m+=(w-m)/4:m=m+(w-m)/2-k.matchHeight/2}}h.css("top",m+"px")}}}}]),myApp.directive("connectors",["connectorService","positioningService","$compile","data",function(a,b,c,d){return{restrict:"E",template:'<div class="connectors"></div>',replace:!0,scope:!1,link:function(e,f){function g(a,b,d,f,g,h,i){var j=null===g?"cMatch1":"cMatch"+g.toString(),k=null===g?h?"tbdB:match.team1.id.length === 0 && match.team2.id.length === 0":"":1==g?"tbdB:match.team1.id.length === 0":"tbdB:match.team2.id.length === 0",l=i?j+".team1.score > "+j+".team2.score && ":"",m=i?j+".team2.score > "+j+".team1.score && ":"",n="highlight: highlight.teamId !== null && ((match.team1.id === highlight.teamId || match.team2.id === highlight.teamId) && (("+l+j+".team1.id === highlight.teamId) || ("+m+j+".team2.id === highlight.teamId)))",o="finals2"===e.match.meta.matchType?",hidden:(prop.finals2 === false)":"",p='ng-class="{'+k+(k.length>0?", ":"")+n+o+'}"';return angular.element(c('<div class="connector" style="left:'+d+"px;top:"+f+"px;width:"+a+"px;height:"+b+'px" '+p+"></div>")(e))}if(2!=e.match.meta.matchType&&"bronze"!=e.match.meta.matchType){var h=b.getBracketProperties(),i=parseInt(e.match.meta.matchId.split("-")[1]),j="L"===e.match.meta.matchId.slice(-1);if(i>1&&(j||!j&&i>h.startingRound)){var k=a.findChildMatch(f.parent()),l=angular.element(a.findConnectingMatch(e.match)[0].firstElementChild);e.cMatch1=l.scope().match;var m=k.prop("offsetLeft"),n=k.prop("offsetTop")+h.matchHeight/2;if(1===e.match.meta.matchType||"finals2"===e.match.meta.matchType){var o="L"===e.match.meta.matchId.slice(-1)||"finals2"===e.match.meta.matchType;return void f.append(g(h.matchMarginH-h.borderThickness,1,m-h.matchMarginH+h.borderThickness,n,null,o).addClass("connectorBottom"))}var p="DE"===d.getTournamentType()&&"finals"===e.match.meta.matchType,q=h.matchMarginH/2,r=n-l.prop("offsetTop")-h.matchHeight/2,s=m-q-h.borderThickness,t=n-r,u=g(q,r,s,t,1,null,p).addClass("connectorBottom connectorLeft");f.append(u),q=h.matchMarginH/2-h.borderThickness,s=s-q+h.borderThickness,f.append(g(q,1,s,t,1,null,p).addClass("connectorTop"));var v=l.scope().match.meta.matchId.split("-"),w="finals"===e.match.meta.matchType&&"DE"===d.getTournamentType(),x=v.length>3||w?"-L":"",y=v[0]+"-"+v[1]+"-"+(w?1:parseInt(v[2])+1)+x,z=angular.element(a.findChildMatch(document.getElementById(y)));e.cMatch2=z.scope().match,q=h.matchMarginH/2,r=z.prop("offsetTop")+h.matchHeight/2-n,s=m-q-h.borderThickness,t=n,f.append(g(q,r,s,t,2).addClass("connectorTop connectorLeft")),q=h.matchMarginH/2-h.borderThickness,s=s-q+h.borderThickness,t=n+r,f.append(g(q,1,s,t,2).addClass("connectorTop"))}}}}}]),myApp.factory("tournament",function(){return{newTournament:function(a,b,c){function d(a,b){return{team1:{id:"",score:""},team2:{id:"",score:""},meta:{matchId:"match-"+a+"-"+b},details:{}}}function e(a,b,c){for(var d=[],e=c?2*a-b:b,f=c?a/Math.abs(2*a-b):a/b,g=0;a>g;g++)d[g]=c?2:0;for(g=0;e>g;g++){var h=Math.round(g*f);d[h]=c?d[h]-1:d[h]+1}return d}function f(a,b,c){function f(a,b){var c,d=0;for(c=0;c<a.length;c++)2!=a[c].meta.matchType&&(d+=1==a[c].meta.matchType?1:2);for(c=d;c<b.length;c++)b[c].meta.UIShiftDown=b[c].meta.UIShiftDown?b[c].meta.UIShiftDown+1:1}var g,h,i=[],j=1,k=null,l=0;if(1===b){for(;2*j<a.length;)j*=2;var m=a.length-j;if(m>0){l=m-j/2;var n=0===l?j:l>0?j+2*l:j-2*Math.abs(l);k=a.slice(n,a.length),a.splice(n,a.length)}}for(g=0;g<a.length;g++){if(h=d(b,i.length+1),1===b){if(g%2!==0)continue;h.team1.id=a[g].id,h.team2.id=a[g+1].id}else if(g%2!==0)continue;i.push(h)}var o;if(1===b&&null!==k&&k.length>0){c.matches.push(i.slice()),c.properties.unbalanced=!0;var p=[];if(0===l)for(g=0;g<k.length;g++)h=d(b+1,p.length+1),h.team1.id=k[g].id,h.meta.matchType=1,p.push(h);else if(l>0){o=e(j/2,k.length,!1);var q=0;for(g=0;g<o.length;g++)h=d(b+1,p.length+1),1===o[g]&&(h.team1.id=k[q].id,h.meta.matchType=1,q+=1),p.push(h)}else if(0>l){o=e(j/2,k.length,!0);var r=0;for(g=0;j/2>g;g++)h=d(b+1,p.length+1),h.team1.id=k[r].id,h.meta.matchType=1,2===o[g]&&(h.team2.id=k[r+1].id,h.meta.matchType=2,f(p,i),r+=1),r+=1,p.push(h)}return a=null,p}return a=null,i}function g(a,b,c,f){var g,h,i,j,k=[];if(!(1===b&&f.matches.length>1||f.properties.unbalanced&&2===b)){var l=b>2&&f.properties.unbalanced&&f.matches[0].length!==f.matches[1].length?1:0,m=!0;if(b>1){var n=c.length-1;for(i=0;i<c[n].length;i++)if(!c[n][i].meta.matchType){m=!1;break}}if(m&&3===b&&(f.matches[0].length<f.matches[1].length||c[0].length===c[1].length)&&(m=!1),(b+l)%2!==0||m)if(f.properties.unbalanced&&2>=b)if(a.length===f.matches[0].length)g=a.length;else{if(a.length>f.matches[0].length){for(c[0]=[],c[1]=[],i=0;i<f.matches[0].length;i++)c[0].push(d(1,i+1+"-L"));var o=c[0].length>a.length/2;for(dist=e(a.length/2,c[0].length,o),i=0;i<a.length/2;i++)j=d(2,i+1+"-L"),o?1===dist[i]&&(j.meta.matchType=1):j.meta.matchType=1===dist[i]?1:2,c[1].push(j);if(!o&&dist.length>c[0].length){var p=0,q=0;for(i=0;i<dist.length;i++)1!==dist[i]?p+=1:(c[0][q].meta.UIShiftDown=p,q+=1)}return}if(a.length<f.matches[0].length){c[0]=[],c[1]=[];var r=0;for(i=0;i<a.length;i++)1===a[i].meta.matchType?(j=d(2,i+1+"-L"),j.meta.matchType=2,c[1].push(j),r+=1):(j=d(1,c[0].length+1+"-L"),j.meta.UIShiftDown=r,c[0].push(j),j=d(2,i+1+"-L"),j.meta.matchType=1,c[1].push(j));return}}else g=Math.floor(1===b?a.length/2:c[c.length-1].length/2);else g=Math.floor(c[c.length-1].length),h=!0;for(i=1;g>=i;i++)j=d(c.length+1,i+"-L"),h&&(j.meta.matchType=1),k.push(j);if(c.push(k),1===a.length)for(;1!==c[c.length-1].length||1!==c[c.length-2].length;){b+=1;var s=[];for(g=Math.floor((b+l)%2===0?c[c.length-1].length:c[c.length-1].length/2),h=(b+l)%2===0,0===g&&(g=1,h=!0),i=1;g>=i;i++)j=d(c.length+1,i+"-L"),h&&(j.meta.matchType=1),s.push(j);c.push(s)}}}var h={type:a,matches:[],properties:{status:"Not started"}};if(b.length<3)return h;for(var i=[],k=[],l=1;1===l||Math.floor(i.length)>1;){var m=i;1===l&&(m=b.slice()),i=f(m,l,h),"DE"===h.type&&g(i,l,k,h),h.matches.push(i.slice()),l=h.matches.length+1}if("DE"===h.type){for(var n=Math.max(h.matches[0].length,h.matches[1].length)+.5,o=0;o<k[0].length;o++)k[0][o].meta.UIShiftDown=isNaN(k[0][o].meta.UIShiftDown)?n:k[0][o].meta.UIShiftDown+n,h.properties.lbOffset=n;n=k.length-h.matches.length;var p,q,r,s=0;if(h.properties.unbalanced){if(h.matches[0].length===h.matches[1].length)for(o=0;2>o;o++)for(p=h.matches[o].length,j=0;j<h.matches[o].length;j++)q="match-"+(o+1+n)+"-"+(j+1),h.matches[o][j].meta.matchId=q,o>0?(k[0][p-1-j].meta.team2Parent=q,h.matches[o][j].meta.loserMatchId=k[0][p-1-j].meta.matchId):(k[0][j].meta.team1Parent=q,h.matches[o][j].meta.loserMatchId=k[0][j].meta.matchId);else if(h.matches[0].length>h.matches[1].length){var t=0,u=0;for(o=0;2>o;o++)for(p=h.matches[o].length,j=0;p>j;j++)h.matches[o][j].meta.matchId="match-"+(o+1+n)+"-"+(j+1),o>0&&(1===h.matches[o][j].meta.matchType?(k[o][j].meta.matchType=2,k[o][j].meta.team1Parent=h.matches[0][t].meta.matchId,k[o][j].meta.team2Parent="match-"+(o+1+n)+"-"+(p-j),h.matches[0][t].meta.loserMatchId=k[o][j].meta.matchId,h.matches[o][p-j-1].meta.loserMatchId=k[o][j].meta.matchId,t+=1):(k[o][j].meta.matchType=1,k[0][u].meta.team1Parent=h.matches[0][t].meta.matchId,k[0][u].meta.team2Parent=h.matches[0][t+1].meta.matchId,k[o][j].meta.team1Parent="match-"+(o+1+n)+"-"+(p-j),h.matches[0][t].meta.loserMatchId=k[0][u].meta.matchId,h.matches[0][t+1].meta.loserMatchId=k[0][u].meta.matchId,h.matches[o][p-j-1].meta.loserMatchId=k[o][j].meta.matchId,u+=1,t+=2))}else if(h.matches[0].length<h.matches[1].length){var v=!1;for(o=0;2>o;o++)for(p=h.matches[o].length,j=0;p>j;j++)if(q="match-"+(o+1+n)+"-"+(j+1),h.matches[o][j].meta.matchId=q,0===o)k[o][j].meta.team1Parent=q,h.matches[o][j].meta.loserMatchId=k[o][j].meta.matchId;else if(h.matches[o][j].meta.matchType)if(v)for(r=0;r<k[1].length;r++){if(!(1!==k[1][r].meta.matchType&&2!==k[1][r].meta.matchType||k[1][r].meta.team1Parent)){k[1][r].meta.team1Parent=q,h.matches[o][j].meta.loserMatchId=k[1][r].meta.matchId;break}if(2===k[1][r].meta.matchType&&!k[1][r].meta.team2Parent){k[1][r].meta.team2Parent=q,h.matches[o][j].meta.loserMatchId=k[1][r].meta.matchId;break}}else k[0][k[0].length-j-1].meta.team2Parent=q,h.matches[o][j].meta.loserMatchId=k[0][k[0].length-j-1].meta.matchId,v=j===k[0].length-1}s=2}for(o=s;o<h.matches.length;o++){var w=2>o?o:2*o-1,x=0;for(h.properties.unbalanced&&(w-=1,x=1),o===h.matches.length-1&&(w=k.length-1),p=h.matches[o].length,j=0;p>j;j++){var y="match-"+(w+1)+"-";for(y+=0===o?Math.floor(j/2)+1:(o+x)%2===0?j+1:p-j,y+="-L",q="match-"+(o+1+n)+"-"+(j+1),r=k[w].length-1;r>=0;r--)if(k[w][r].meta.matchId===y){k[w][r].meta.team1Parent?k[w][r].meta.team2Parent=q:k[w][r].meta.team1Parent=q;break}h.matches[o][j].meta.matchId=q,h.matches[o][j].meta.loserMatchId=y}}for(j=h.matches.length-1,o=k.length-1;o>=0;o--)j>=0?h.matches[j]=h.matches[j].concat(k[o]):h.matches.unshift(k[o]),j-=1;h.matches.push(new Array(d(h.matches.length+1,1)));var z=d(h.matches.length,h.matches[h.matches.length-1].length+1);z.meta.matchType="finals2",h.matches[h.matches.length-1].push(z)}if(h.matches[h.matches.length-1][0].meta.matchType="finals",c){var A=d(h.matches.length,h.matches[h.matches.length-1].length+1);A.meta.matchType="bronze",h.matches[h.matches.length-1].push(A)}return h}}});