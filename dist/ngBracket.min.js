/*! ngBracket 09-09-2014 */
function findParentByAttribute(a,b,c){if(null===a||null===b||null===c)return null;for(var d=null,e=angular.element(a);null!==e.parent()&&e.parent().length>0;)if(e=e.parent(),e.attr(b)===c){d=e;break}return d}function findFirstRound(a){for(var b=0;b<a.length;b++)if("L"!==a[b][0].meta.matchId.slice(-1))return b;return null}var myApp=angular.module("ngBracket",[]);myApp.filter("iif",function(){return function(a,b,c){return a?b:c}}),myApp.filter("getById",function(){return function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];return null}}),myApp.factory("highlight",function(){var a={teamId:null};return{mapHighlight:function(){return a},setHighlight:function(b){a.teamId=b&&b.length>0?b:null}}}),myApp.factory("data",function(){var a={},b={},c=null;return{getParticipants:function(){return a},getMatches:function(){return b.matches},getTournamentType:function(){return b.type},getProperties:function(){return b.properties},setParticipants:function(b){a=b},setTournament:function(a){b=a,c="DE"===a.type?findFirstRound(a.matches):null},updateTournament:function(a,c,d,e,f){function g(a,b,c,d){null!==a&&(-1!==c.indexOf(a.team1.id)?a.team1.id=b:-1!==c.indexOf(a.team2.id)?a.team2.id=b:!(d||v>n)||a.team1.id&&0!==a.team1.id.length?a.team2.id=b:a.team1.id=b)}function h(a,c){for(var d=0;d<b.matches[c].length;d++)if(b.matches[c][d].meta.matchType==a)return b.matches[c][d];return null}var i,j,k,l=a.meta.matchId.split("-"),m=parseInt(l[1]),n=parseInt(l[2]),o=l.length>3&&"L"===l[3],p=m===b.matches.length-1,q=a.team1.id===c?a.team2.id:a.team1.id;if("DE"===b.type&&"finals"===a.meta.matchType){var r=b.matches.length-2;k=b.matches[r].length-1,j=b.matches[r][k].team1.score>b.matches[r][k].team2.score?b.matches[r][k].team1.id:b.matches[r][k].team2.id,b.properties.finals2=q!=j;var s=h("finals2",b.matches.length-1);return void(q!=j?null!==s&&(s.team1.id=a.team1.id,s.team2.id=a.team2.id):null!==s&&(s.team1.id="",s.team2.id="",s.team1.score="",s.team2.score=""))}if(("SE"!==b.type||m!==b.matches.length)&&("DE"!==b.type||"bronze"!==a.meta.matchType&&"finals2"!==a.meta.matchType)){var t=[a.team1.id,a.team2.id];if(null!==e&&e.length>0&&t.push(e),"SE"===b.type&&p&&b.matches[b.matches.length-1].length>1||"DE"===b.type&&o&&(p||m===b.matches.length-2)){k=b.matches[b.matches.length-1].length;var u=h("bronze",b.matches.length-1);g(u,q,t,1===n)}var v=0,w=b.matches[m],x=o&&p;for(i=0;i<w.length;i++)if(2!=w[i].meta.matchType){if(o&&"L"!==w[i].meta.matchId.slice(-1)&&!p)continue;if(v+=1==w[i].meta.matchType?1:2,v>=n){g(w[i],c,t,x);break}}if(f){var y=parseInt(a.meta.loserMatchId.split("-")[1])-1,z=b.matches[y];for(i=z.length-1;i>=0;i--){if(z[i].meta.team1Parent===a.meta.matchId){z[i].team1.id=d;break}if(z[i].meta.team2Parent===a.meta.matchId){z[i].team2.id=d;break}}}}},loadTournament:function(a,b){this.setParticipants(b),this.setTournament(a)}}}),myApp.factory("connectorService",["data",function(a){return{findConnectingMatch:function(b){var c,d,e=parseInt(b.match.meta.matchId.split("-")[1]),f=parseInt(b.match.meta.matchId.split("-")[2]),g="L"===b.match.meta.matchId.slice(-1)?"-L":"",h=0,i=a.getMatches(),j=0;if("finals2"===b.match.meta.matchType)d="match-"+e+"-1";else{if(g.length>0)for(c=0;c<i[e-1].length;c++)if("L"===i[e-1][c].meta.matchId.slice(-1)){j=c;break}for(c=0;f>c;c++)2!=i[e-1][c+j].meta.matchType&&(h+=1==i[e-1][c+j].meta.matchType||c+1==f?1:2);d="match-"+(e-1)+"-"+h+g}return angular.element(document.getElementById(d))},findChildMatch:function(a){for(var b=angular.element(a).children(),c=0;c<b.length;c++)if(angular.element(b[c]).hasClass("match"))return angular.element(b[c])}}}]),myApp.factory("positioningService",["data",function(a){var b=function(b){function c(a){return"L"!==a.meta.matchId.slice(-1)}function e(a){return"L"===a.meta.matchId.slice(-1)}var f=document.getElementsByClassName("roundHeader")[0],g=document.getElementsByClassName("round")[0];if(matchEl=document.createElement("div"),matchEl.style.visibility="hidden",matchEl.className="match",g.appendChild(matchEl),document.all?(b.matchHeight=matchEl.currentStyle.height,b.matchWidth=matchEl.currentStyle.width,b.matchMarginH=parseInt(matchEl.currentStyle.marginRight),b.matchMarginV=parseInt(matchEl.currentStyle.marginTop)+parseInt(matchEl.currentStyle.marginBottom),b.borderThickness=parseInt(matchEl.currentStyle.borderWidth),b.roundMarginTop=f.currentStyle.height+parseInt(f.currentStyle.marginTop)+parseInt(f.currentStyle.marginBottom)):(b.matchHeight=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("height").replace("px","")),b.matchWidth=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("width").replace("px","")),b.matchMarginH=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-right").replace("px","")),b.matchMarginV=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("margin-bottom")),b.borderThickness=parseInt(document.defaultView.getComputedStyle(matchEl,"").getPropertyValue("border-right-width")),b.roundMarginTop=parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("height").replace("px",""))+parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(f,"").getPropertyValue("margin-bottom"))),"DE"===a.getTournamentType()){var h=a.getMatches(),i=findFirstRound(h);i&&(b.startingRound=i+1,b.roundHeight=Math.max(h[i].filter(c).length,h[i+1].filter(c).length),b.roundHeight+=Math.max(h[0].filter(e).length,h[1].filter(e).length)),b.lbOffset=a.getProperties().lbOffset*(b.matchHeight+b.matchMarginV)+b.roundMarginTop}g.removeChild(matchEl),d=!0},c={matchHeight:null,matchWidth:null,matchMarginH:null,matchMarginV:null,borderThickness:null,roundMarginTop:null,startingRound:null,roundHeight:null,lbOffset:null},d=!1;return{getBracketProperties:function(){return d||b(c),JSON.parse(JSON.stringify(c))},resetProperties:function(){d=!1,c.startingRound=null,c.roundHeight=null}}}]),myApp.factory("matchDetailService",function(){var a=null,b={},c="",d=!1,e=!1;return{setEnabled:function(a){e=a},mapMatchDetails:function(){return b},showDetails:function(f,g){if(e){if(null!==a&&"visible"==a.css("visibility")&&g.matchId==c)return void this.hideDetails();if(c=g.matchId,b.team1Details=g.team1Details,b.team2Details=g.team2Details,b.results=g.results,d||(a=angular.element(document.getElementById("detailOverlay")),d=!0),null!==a&&null!==f){var h=findParentByAttribute(f,"class","match")[0];if(null!==h&&h.getBoundingClientRect()){var i=h.getBoundingClientRect(),j=i.right+(void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft),k=i.top+(void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop);a.css("left",j+"px"),a.css("top",k-20+"px"),a.css("visibility","visible")}}}},hideDetails:function(){null!==a&&a.css("visibility","hidden")}}});var myApp=angular.module("ngBracket");myApp.directive("doFocus",function(){return{restrict:"A",link:function(a,b){b&&(b[0].focus(),b[0].select())}}}),myApp.directive("score",["data",function(a){return{restrict:"E",scope:{team:"=",match:"=",results:"="},templateUrl:"partials/score.html",link:function(b){b.editScore=function(){b.match.team1.id&&b.match.team2.id&&(b.status="editable")},b.calculateResults=function(c){if("undefined"==typeof b.match.team1.score||""===b.match.team1.score||"undefined"==typeof b.match.team2.score||""===b.match.team2.score||b.match.team1.score===b.match.team2.score)return b.results.winner="",void(b.results.loser="");var d;b.match.team1.score>b.match.team2.score?(d=b.match.team1.id,b.results.loser=b.match.team2.id):(d=b.match.team2.id,b.results.loser=b.match.team1.id),b.results.winner=d;var e="DE"===a.getTournamentType()&&"L"!==b.match.meta.matchId.slice(-1);a.updateTournament(b.match,d,b.results.loser,c,e)},b.endEditScore=function(){b.status="uneditable",b.calculateResults(null)},b.$watch("match.team1.id",function(a,c){a&&b.calculateResults(c)},!0),b.$watch("match.team2.id",function(a,c){a&&b.calculateResults(c)},!0)},replace:!0}}]),myApp.directive("match",["connectorService","positioningService","data","$filter","highlight","matchDetailService",function(a,b,c,d,e,f){return{restrict:"E",scope:!1,templateUrl:"partials/match.html",replace:!0,link:function(g,h){g.getTeamDetails=function(a){return d("getById")(c.getParticipants(),a)},g.highlightTrack=function(a){e.setHighlight(a)},g.showDetails=function(a){null!==g.team1Details&&null!==g.team2Details&&a.target&&!angular.element(a.target).hasClass("score")&&f.showDetails(a.target,{matchId:g.match.meta.matchId,team1Details:g.team1Details,team2Details:g.team2Details,results:g.match})},g.team1Details=g.getTeamDetails(g.match.team1.id),g.team2Details=g.getTeamDetails(g.match.team2.id),g.$watch("match.team1",function(a){a&&(g.team1Details=g.getTeamDetails(g.match.team1.id))},!0),g.$watch("match.team2",function(a){a&&(g.team2Details=g.getTeamDetails(g.match.team2.id))},!0);var i=parseInt(g.match.meta.matchId.split("-")[1]),j=parseInt(g.match.meta.matchId.split("-")[2]),k=b.getBracketProperties();g.match.meta.team1Parent&&(g.team1Description="Loser of Round "+(parseInt(g.match.meta.team1Parent.split("-")[1])-k.startingRound+1)+" match "+g.match.meta.team1Parent.split("-")[2]),g.match.meta.team2Parent&&(g.team2Description="Loser of Round "+(parseInt(g.match.meta.team2Parent.split("-")[1])-k.startingRound+1)+" match "+g.match.meta.team2Parent.split("-")[2]),"finals2"===g.match.meta.matchType&&0===g.match.team1.id.length&&0===g.match.team2.id.length&&(g.team1Description="Finals round 2 if necessary",g.prop=c.getProperties()),h.prop("id","match-"+i+"-"+j),"finals"==g.match.meta.matchType&&(g.finals=!0),h.css("left",k.matchMarginH/2+"px");var l="finals2"===g.match.meta.matchType&&"DE"===c.getTournamentType();l&&h.css("left",k.matchMarginH/2+k.matchMarginH+k.matchWidth+"px");var m=0,n="finals"===g.match.meta.matchType&&"DE"===c.getTournamentType(),o="L"===g.match.meta.matchId.slice(-1)||n?"-L":"";if(1===i||i===k.startingRound&&0===o.length){var p=g.match.meta.UIShiftDown?g.match.meta.UIShiftDown:0;m=(k.matchHeight+k.matchMarginV)*(j-1+p)+k.roundMarginTop}else if(2===g.match.meta.matchType)m=(k.matchHeight+k.matchMarginV)*(j-1)+k.roundMarginTop,o.length>0&&k.lbOffset>0&&m<k.lbOffset&&(m+=k.lbOffset-k.roundMarginTop);else if("bronze"===g.match.meta.matchType){g.bronzeMatch=!0;var q=angular.element(document.getElementById("match-"+i+"-1"));m=q.prop("offsetTop")+k.matchHeight+40}else if(l){var r=angular.element(document.getElementById("match-"+i+"-1"));m=r.prop("offsetTop")}else{var s=a.findConnectingMatch(g,h);if(m=angular.element(s[0].firstElementChild).prop("offsetTop"),1!=g.match.meta.matchType){var t=parseInt(s.scope().match.meta.matchId.split("-")[2]),u="match-"+(i-1)+"-"+(n?"1-L":t+1+o),v=angular.element(document.getElementById(u)),w=angular.element(v[0].firstElementChild).prop("offsetTop")+k.matchHeight;n?m+=(w-m)/4:m=m+(w-m)/2-k.matchHeight/2}}h.css("top",m+"px")}}}]),myApp.directive("connectors",["connectorService","positioningService","$compile","data",function(a,b,c,d){return{restrict:"E",template:'<div class="connectors"></div>',replace:!0,scope:!1,link:function(e,f){function g(a,b,d,f,g,h,i){var j=null===g?"cMatch1":"cMatch"+g.toString(),k=null===g?h?"tbdB:match.team1.id.length === 0 && match.team2.id.length === 0":"":1==g?"tbdB:match.team1.id.length === 0":"tbdB:match.team2.id.length === 0",l=i?j+".team1.score > "+j+".team2.score && ":"",m=i?j+".team2.score > "+j+".team1.score && ":"",n="highlight: highlight.teamId !== null && ((match.team1.id === highlight.teamId || match.team2.id === highlight.teamId) && (("+l+j+".team1.id === highlight.teamId) || ("+m+j+".team2.id === highlight.teamId)))",o="finals2"===e.match.meta.matchType?",hidden:(prop.finals2 === false)":"",p='ng-class="{'+k+(k.length>0?", ":"")+n+o+'}"';return angular.element(c('<div class="connector" style="left:'+d+"px;top:"+f+"px;width:"+a+"px;height:"+b+'px" '+p+"></div>")(e))}if(2!=e.match.meta.matchType&&"bronze"!=e.match.meta.matchType){var h=b.getBracketProperties(),i=parseInt(e.match.meta.matchId.split("-")[1]),j="L"===e.match.meta.matchId.slice(-1);if(i>1&&(j||!j&&i>h.startingRound)){var k=a.findChildMatch(f.parent()),l=angular.element(a.findConnectingMatch(e,f)[0].firstElementChild);e.cMatch1=l.scope().match;var m=k.prop("offsetLeft"),n=k.prop("offsetTop")+h.matchHeight/2;if(1===e.match.meta.matchType||"finals2"===e.match.meta.matchType){var o="L"===e.match.meta.matchId.slice(-1)||"finals2"===e.match.meta.matchType;return void f.append(g(h.matchMarginH-h.borderThickness,1,m-h.matchMarginH+h.borderThickness,n,null,o).addClass("connectorBottom"))}var p="DE"===d.getTournamentType()&&"finals"===e.match.meta.matchType,q=h.matchMarginH/2,r=n-l.prop("offsetTop")-h.matchHeight/2,s=m-q-h.borderThickness,t=n-r,u=g(q,r,s,t,1,null,p).addClass("connectorBottom connectorLeft");f.append(u),q=h.matchMarginH/2-h.borderThickness,s=s-q+h.borderThickness,f.append(g(q,1,s,t,1,null,p).addClass("connectorTop"));var v=l.scope().match.meta.matchId.split("-"),w="finals"===e.match.meta.matchType&&"DE"===d.getTournamentType(),x=v.length>3||w?"-L":"",y=v[0]+"-"+v[1]+"-"+(w?1:parseInt(v[2])+1)+x,z=angular.element(a.findChildMatch(document.getElementById(y)));e.cMatch2=z.scope().match,q=h.matchMarginH/2,r=z.prop("offsetTop")+h.matchHeight/2-n,s=m-q-h.borderThickness,t=n,f.append(g(q,r,s,t,2).addClass("connectorTop connectorLeft")),q=h.matchMarginH/2-h.borderThickness,s=s-q+h.borderThickness,t=n+r,f.append(g(q,1,s,t,2).addClass("connectorTop"))}}}}}]),myApp.factory("tournament",["data","positioningService",function(a,b){return{newTournament:function(c,d,e){function f(a,b){return{team1:{id:"",score:""},team2:{id:"",score:""},meta:{matchId:"match-"+a+"-"+b},details:{}}}function g(a,b,c){for(var d=[],e=c?2*a-b:b,f=c?a/Math.abs(2*a-b):a/b,g=0;a>g;g++)d[g]=c?2:0;for(g=0;e>g;g++){var h=Math.round(g*f);d[h]=c?d[h]-1:d[h]+1}return d}function h(a,b,c){function d(a,b){var c,d=0;for(c=0;c<a.length;c++)2!=a[c].meta.matchType&&(d+=1==a[c].meta.matchType?1:2);for(c=d;c<b.length;c++)b[c].meta.UIShiftDown=b[c].meta.UIShiftDown?b[c].meta.UIShiftDown+1:1}var e,h,i=[],j=1,k=null,l=0;if(1===b){for(;2*j<a.length;)j*=2;var m=a.length-j;if(m>0){l=m-j/2;var n=0===l?j:l>0?j+2*l:j-2*Math.abs(l);k=a.slice(n,a.length),a.splice(n,a.length)}}for(e=0;e<a.length;e++){if(h=f(b,i.length+1),1===b){if(e%2!==0)continue;h.team1.id=a[e].id,h.team2.id=a[e+1].id}else if(e%2!==0)continue;i.push(h)}var o;if(1===b&&null!==k&&k.length>0){c.matches.push(i.slice()),c.properties.unbalanced=!0;var p=[];if(0===l)for(e=0;e<k.length;e++)h=f(b+1,p.length+1),h.team1.id=k[e].id,h.meta.matchType=1,p.push(h);else if(l>0){o=g(j/2,k.length,!1);var q=0;for(e=0;e<o.length;e++)h=f(b+1,p.length+1),1===o[e]&&(h.team1.id=k[q].id,h.meta.matchType=1,q+=1),p.push(h)}else if(0>l){o=g(j/2,k.length,!0);var r=0;for(e=0;j/2>e;e++)h=f(b+1,p.length+1),h.team1.id=k[r].id,h.meta.matchType=1,2===o[e]&&(h.team2.id=k[r+1].id,h.meta.matchType=2,d(p,i),r+=1),r+=1,p.push(h)}return a=null,p}return a=null,i}function i(a,b,c,d){var e,h,i,j,k=[];if(!(1===b&&d.matches.length>1||d.properties.unbalanced&&2===b)){var l=b>2&&d.properties.unbalanced&&d.matches[0].length!==d.matches[1].length?1:0,m=!0;if(b>1){var n=c.length-1;for(i=0;i<c[n].length;i++)if(!c[n][i].meta.matchType){m=!1;break}}if(m&&3===b&&(d.matches[0].length<d.matches[1].length||c[0].length===c[1].length)&&(m=!1),(b+l)%2!==0||m)if(d.properties.unbalanced&&2>=b)if(a.length===d.matches[0].length)e=a.length;else{if(a.length>d.matches[0].length){for(c[0]=[],c[1]=[],i=0;i<d.matches[0].length;i++)c[0].push(f(1,i+1+"-L"));var o=c[0].length>a.length/2;for(dist=g(a.length/2,c[0].length,o),i=0;i<a.length/2;i++)j=f(2,i+1+"-L"),o?1===dist[i]&&(j.meta.matchType=1):j.meta.matchType=1===dist[i]?1:2,c[1].push(j);if(!o&&dist.length>c[0].length){var p=0,q=0;for(i=0;i<dist.length;i++)1!==dist[i]?p+=1:(c[0][q].meta.UIShiftDown=p,q+=1)}return}if(a.length<d.matches[0].length){c[0]=[],c[1]=[];var r=0;for(i=0;i<a.length;i++)1===a[i].meta.matchType?(j=f(2,i+1+"-L"),j.meta.matchType=2,c[1].push(j),r+=1):(j=f(1,c[0].length+1+"-L"),j.meta.UIShiftDown=r,c[0].push(j),j=f(2,i+1+"-L"),j.meta.matchType=1,c[1].push(j));return}}else e=Math.floor(1===b?a.length/2:c[c.length-1].length/2);else e=Math.floor(c[c.length-1].length),h=!0;for(i=1;e>=i;i++)j=f(c.length+1,i+"-L"),h&&(j.meta.matchType=1),k.push(j);if(c.push(k),1===a.length)for(;1!==c[c.length-1].length||1!==c[c.length-2].length;){b+=1;var s=[];for(e=Math.floor((b+l)%2===0?c[c.length-1].length:c[c.length-1].length/2),h=(b+l)%2===0,0===e&&(e=1,h=!0),i=1;e>=i;i++)j=f(c.length+1,i+"-L"),h&&(j.meta.matchType=1),s.push(j);c.push(s)}}}var k={type:c,matches:[],properties:{}};if(d.length<3)return k;b.resetProperties(),a.setParticipants(d.slice());for(var l=[],m=[],n=1;1===n||Math.floor(l.length)>1;){var o=l;1===n&&(o=d.slice()),l=h(o,n,k),"DE"===k.type&&i(l,n,m,k),k.matches.push(l.slice()),n=k.matches.length+1}if("DE"===k.type){for(var p=Math.max(k.matches[0].length,k.matches[1].length)+.5,q=0;q<m[0].length;q++)m[0][q].meta.UIShiftDown=isNaN(m[0][q].meta.UIShiftDown)?p:m[0][q].meta.UIShiftDown+p,k.properties.lbOffset=p;p=m.length-k.matches.length;var r,s,t,u=0;if(k.properties.unbalanced){if(k.matches[0].length===k.matches[1].length)for(q=0;2>q;q++)for(r=k.matches[q].length,j=0;j<k.matches[q].length;j++)s="match-"+(q+1+p)+"-"+(j+1),k.matches[q][j].meta.matchId=s,q>0?(m[0][r-1-j].meta.team2Parent=s,k.matches[q][j].meta.loserMatchId=m[0][r-1-j].meta.matchId):(m[0][j].meta.team1Parent=s,k.matches[q][j].meta.loserMatchId=m[0][j].meta.matchId);else if(k.matches[0].length>k.matches[1].length){var v=0,w=0;for(q=0;2>q;q++)for(r=k.matches[q].length,j=0;r>j;j++)k.matches[q][j].meta.matchId="match-"+(q+1+p)+"-"+(j+1),q>0&&(1===k.matches[q][j].meta.matchType?(m[q][j].meta.matchType=2,m[q][j].meta.team1Parent=k.matches[0][v].meta.matchId,m[q][j].meta.team2Parent="match-"+(q+1+p)+"-"+(r-j),k.matches[0][v].meta.loserMatchId=m[q][j].meta.matchId,k.matches[q][r-j-1].meta.loserMatchId=m[q][j].meta.matchId,v+=1):(m[q][j].meta.matchType=1,m[0][w].meta.team1Parent=k.matches[0][v].meta.matchId,m[0][w].meta.team2Parent=k.matches[0][v+1].meta.matchId,m[q][j].meta.team1Parent="match-"+(q+1+p)+"-"+(r-j),k.matches[0][v].meta.loserMatchId=m[0][w].meta.matchId,k.matches[0][v+1].meta.loserMatchId=m[0][w].meta.matchId,k.matches[q][r-j-1].meta.loserMatchId=m[q][j].meta.matchId,w+=1,v+=2))}else if(k.matches[0].length<k.matches[1].length){var x=!1;for(q=0;2>q;q++)for(r=k.matches[q].length,j=0;r>j;j++)if(s="match-"+(q+1+p)+"-"+(j+1),k.matches[q][j].meta.matchId=s,0===q)m[q][j].meta.team1Parent=s,k.matches[q][j].meta.loserMatchId=m[q][j].meta.matchId;else if(k.matches[q][j].meta.matchType)if(x)for(t=0;t<m[1].length;t++){if(!(1!==m[1][t].meta.matchType&&2!==m[1][t].meta.matchType||m[1][t].meta.team1Parent)){m[1][t].meta.team1Parent=s,k.matches[q][j].meta.loserMatchId=m[1][t].meta.matchId;break}if(2===m[1][t].meta.matchType&&!m[1][t].meta.team2Parent){m[1][t].meta.team2Parent=s,k.matches[q][j].meta.loserMatchId=m[1][t].meta.matchId;break}}else m[0][m[0].length-j-1].meta.team2Parent=s,k.matches[q][j].meta.loserMatchId=m[0][m[0].length-j-1].meta.matchId,x=j===m[0].length-1}u=2}for(q=u;q<k.matches.length;q++){var y=2>q?q:2*q-1,z=0;for(k.properties.unbalanced&&(y-=1,z=1),q===k.matches.length-1&&(y=m.length-1),r=k.matches[q].length,j=0;r>j;j++){var A="match-"+(y+1)+"-";for(A+=0===q?Math.floor(j/2)+1:(q+z)%2===0?j+1:r-j,A+="-L",s="match-"+(q+1+p)+"-"+(j+1),t=m[y].length-1;t>=0;t--)if(m[y][t].meta.matchId===A){m[y][t].meta.team1Parent?m[y][t].meta.team2Parent=s:m[y][t].meta.team1Parent=s;break}k.matches[q][j].meta.matchId=s,k.matches[q][j].meta.loserMatchId=A}}for(j=k.matches.length-1,q=m.length-1;q>=0;q--)j>=0?k.matches[j]=k.matches[j].concat(m[q]):k.matches.unshift(m[q]),j-=1;k.matches.push(new Array(f(k.matches.length+1,1)));var B=f(k.matches.length,k.matches[k.matches.length-1].length+1);B.meta.matchType="finals2",k.matches[k.matches.length-1].push(B)}if(k.matches[k.matches.length-1][0].meta.matchType="finals",e){var C=f(k.matches.length,k.matches[k.matches.length-1].length+1);C.meta.matchType="bronze",k.matches[k.matches.length-1].push(C)}return a.setTournament(k),k}}}]);